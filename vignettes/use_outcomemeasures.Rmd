---
title: "How to produce an IPEDS Outcome Measures upload file"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{How to produce an IPEDS Outcome Measures upload file}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Step 0: Install/Load the package
```{r setup, eval=FALSE}
#install option 1
devtools::install_github("AlisonLanski/IPEDSuploadables")

#install option 2
githubinstall::githubinstall("IPEDSuploadables")

#load the packages
library(IPEDSuploadables)
```

## Step 1: Load your institution data

Read in your data 
For setup requirements, consult [this prep vignette](setup_for_om.html) for column names, column types, and accepted values.  
  
To test the functions without using your own institutional data, you can create dummy data by running  

```{r dummy_data, eval = FALSE}
dat_student <- create_dummy_data_om()
```


## Step 2: Produce your IPEDS report

Run the wrapper function to produce all portions of your report into a txt for upload.  

* Only the first argument (df) is required and is for your student data.  
* To run only a single part of the report, change "ALL" to "A", "B", "C", or "D"
* The first time you run this function, you'll be asked to browse to the file location where the report will be saved. This location can be changed later.

```{r produce_report, eval=FALSE}
#full export
produce_om_report(df = dat_student, part = "ALL")

#if you only want to look at part D
produce_om_report(dat_student, part = "D")
```


This file will produce a status message for each part that is asked for.  When running "all" outcome measures parts, you'll see the message 4 times even though there is only 1 output file.  This is a known bug that doesn't affect functionality.

#### Note: If you prefer to avoid the wrapper function, you can run its individual parts.  

First, prep the data by running it through a script which recodes CohortStatus for easier processing and regularizes some datatypes  
*Prep script is minimal right now; we have plans for more robust checks*
Then, run the individual component scripts
Use the help for these components to see how to produce the txt file, an easier-to-view file, or both.

```{r prep_script, eval = FALSE}
dat_student <- prep_om_data_frame(dat_student)
```
 
Use the help for these components to see how to produce the txt file, an easier-to-view file, or both.

```{r part_script, eval = FALSE}
make_om_part_A(dat_student)
make_om_part_B(dat_student)
make_om_part_C(dat_student)
make_om_part_D(dat_student)
```

We recommend only using the individual component scripts for troubleshooting.  To submit the individual results in Step 4, you'll need to first combine them into a single text file.


## Step 4: Upload your IPEDS report

A. Navigate to the IPEDS submission portal and log in.  
B. Select "Outcome Measures", select "key-value pair", then browse to your .txt file and upload.  
C. After your file uploads, continue your standard process to check edits, enter metadata, review results, lock, and submit the survey.

